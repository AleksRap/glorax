"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}document.addEventListener("DOMContentLoaded",function(){var e=document.documentElement.clientWidth,o=document.querySelectorAll(".nav__item"),i=document.querySelectorAll(".nav__mobile-item"),c=["projects","about-us","map","rooms"].map(function(e){var t=document.querySelector(".header").clientHeight;return window.pageYOffset+document.querySelector("#".concat(e)).getBoundingClientRect().top-t});window.addEventListener("scroll",function(){for(var e=document.documentElement.scrollTop,t=null,n=0;n<c.length;n++){var a=c[n+1]||document.body.scrollHeight;if(e>=c[n]&&e<a){t=n;break}}for(var r=0;r<o.length;r++)o[r].classList.remove("select"),i[r].classList.remove("select");null!==t&&(o[t].classList.add("select"),i[t].classList.add("select"))});var t=document.querySelector('[data-mobile-nav="open"]'),n=document.querySelector('[data-mobile-nav="close"]'),a=document.querySelector(".nav__callback-btn_mobile"),r=document.querySelector(".nav__mobile-list-wrap");t.addEventListener("click",function(){r.classList.add("open")}),n.addEventListener("click",function(){r.classList.remove("open")}),a.addEventListener("click",function(){r.classList.remove("open")}),r.addEventListener("click",function(e){e.target.closest(".nav__mobile-link")&&r.classList.remove("open")}),window.addEventListener("click",function(e){var t=e.target.closest(".nav__mobile-list-wrap"),n=e.target.closest('[data-mobile-nav="open"]');t||n||r.classList.remove("open")}),new Modal({idModal:"modal-callback",selectorBtnOpen:"[data-open-modal]"});var s=new Modal({idModal:"modal-send-success"});e<1e3&&document.querySelector(".projects__cards").addEventListener("click",function(e){var t=e.target.closest(".card-real-estate");t&&t.classList.toggle("open")});var l=document.querySelector(".header"),d=l.clientHeight;function u(){window.pageYOffset>d?l.classList.add("header_color"):l.classList.remove("header_color")}u(),window.addEventListener("scroll",u),new Swiper(".main-screen__swiper-container",{slidesPerView:1,initialSlide:0,loop:!0,autoplay:{delay:6e3},speed:1500,pagination:{el:".main-screen__pagination",clickable:!0}}),new Swiper(".card-tower__swiper-container",{slidesPerView:1,initialSlide:0,loop:!0,autoplay:{delay:6e3},speed:1500,pagination:{el:".card-tower__pagination",clickable:!0}});var _=document.querySelectorAll('[href^="#"]');_.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var i=window.pageYOffset,t=e.target.href.replace(/[^#]*(.*)/,"$1"),c=document.querySelector(t).getBoundingClientRect().top,s=null;requestAnimationFrame(function e(t){null===s&&(s=t);var n=t-s;var a=document.querySelector(".header").clientHeight;var r=i+c-a;var o=c<0?Math.max(i-n/.3,r):Math.min(i+n/.3,r);window.scrollTo(0,o);o!==r&&requestAnimationFrame(e)})})});var h=document.querySelector('[data-input="tel"]');h.addEventListener("input",mask),h.addEventListener("focus",mask),h.addEventListener("blur",mask),document.querySelectorAll(".card-tower").forEach(function(e){return new Layouts(e)}),document.querySelectorAll(".card-tower__img_desktop").forEach(function(e,t){return new GalleryCards(e,t)});var v=document.querySelector("[data-form]"),m=v.querySelector("[data-send]"),f=v.querySelector('[data-form="error"]'),y=v.querySelector("[data-loader]"),p=v.querySelector('[data-form="name"]'),b=v.querySelector('[data-form="phone"]'),g=v.querySelector('[data-form="project_id"]'),w=v.querySelector('[data-form="time"]');[p,b,g,w].forEach(function(e){return e.addEventListener("input",function(){return f.classList.remove("active")})}),v.addEventListener("submit",function(e){e.preventDefault(),m.setAttribute("disabled",!0),y.classList.add("active");var t={name:p.value,phone:b.value,projectId:g.value,time:w.value},n={name:t.name,email:"",phone:t.phone,message:t.time};function a(){p.value="",b.value="",g.value="1",w.value=""}Comagic.addOfflineRequest(n),fetch("/api/request/send",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){var t=e.status,n=e.message;if("success"!==t)throw new Error(void 0===n?"":n);s.open(),a(),dataLayer.push({event:"formsuccess"})}).catch(function(e){f.innerHTML="Произошла ошибка, попробуйте снова<br>(".concat(e,")"),f.classList.add("active")}).finally(function(){m.removeAttribute("disabled"),y.classList.remove("active"),document.addEventListener("closeModal",function(){f.classList.remove("active"),a()},{once:!0})})}),document.querySelectorAll("[data-value-select]").forEach(function(e){e.addEventListener("click",function(e){g.value=e.target.closest("button").dataset.valueSelect})})});var ManagementEvents=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"addEventToArr",value:function(e){return e.arr.push({el:e.el,event:e.event,fn:e.fn}),e.el.addEventListener(e.event,e.fn),!0}},{key:"removeEvents",value:function(e){return e.forEach(function(e){e.el.removeEventListener(e.event,e.fn)}),e.splice(0,e.length),!0}}]),e}(),Modal=function(){function t(e){_classCallCheck(this,t),this.arrEvents=[],this._modal=document.getElementById(e.idModal),this._modalWindow=this._modal.querySelector('[data-modal="window"]'),this._btnsOpen=document.querySelectorAll(e.selectorBtnOpen),this._btnsClose=this._modal.querySelectorAll('[data-modal="close"]'),this.bind()}return _createClass(t,[{key:"open",value:function(){this.closeAllModals(),this._modal.classList.add("modal_open"),this._modalWindow.classList.add("modal__window_open")}},{key:"close",value:function(){this._modal.classList.remove("modal_open"),this._modalWindow.classList.remove("modal__window_open"),this.generateEvent()}},{key:"bind",value:function(){var t=this;this._btnsOpen.forEach(function(e){ManagementEvents.addEventToArr({arr:t.arrEvents,el:e,event:"click",fn:function(){return t.open()}})}),ManagementEvents.addEventToArr({arr:this.arrEvents,el:this._modal,event:"click",fn:function(e){return!e.target.closest("[data-modal=window]")&&t.close()}}),this._btnsClose.forEach(function(e){ManagementEvents.addEventToArr({arr:t.arrEvents,el:e,event:"click",fn:function(){return t.close()}})})}},{key:"closeAllModals",value:function(){_toConsumableArray(document.querySelectorAll(".modal")).forEach(function(e){e.classList.remove("modal_open");var t=e.querySelector("textarea");t&&(t.value="")})}},{key:"generateEvent",value:function(){var t=new Event("closeModal",{bubbles:!0});this._btnsClose.forEach(function(e){return e.dispatchEvent(t)})}},{key:"destroy",value:function(){ManagementEvents.removeEvents(this.arrEvents),this._modal.remove()}}]),t}();function setCursorPosition(e,t){var n;t.focus(),t.setSelectionRange?t.setSelectionRange(e,e):t.createTextRange&&((n=t.createTextRange()).collapse(!0),n.moveEnd("character",e),n.moveStart("character",e),n.select())}function mask(e){var t="+7 (___) ___ ____",n=0,a=t.replace(/\D/g,""),r=this.value.replace(/\D/g,"");a.length>=r.length&&(r=a),this.value=t.replace(/./g,function(e){return/[_\d]/.test(e)&&n<r.length?r.charAt(n++):n>=r.length?"":e}),"blur"===e.type?2===this.value.length&&(this.value=""):setCursorPosition(this.value.length,this)}var Layouts=function(){function t(e){_classCallCheck(this,t),this._wrap=e,this._allCards=document.querySelectorAll(".card-tower"),this._body=this._wrap.querySelector(".card-tower__body"),this._allBlock=this._wrap.querySelectorAll("[data-block]"),this._btnAbout=this._wrap.querySelector('[data-btn="about"]'),this._btnLayouts=this._wrap.querySelector('[data-btn="layouts"]'),this._btnClose=this._wrap.querySelector('[data-btn="close"]'),this._about=this._wrap.querySelector(".card-tower__general-information"),this._layouts=this._wrap.querySelector(".card-tower__layouts"),this._rowsWrap=this._wrap.querySelector(".card-tower__table-row-wrap"),this._images=this._wrap.querySelector(".card-tower__table-img"),this._bind()}return _createClass(t,[{key:"showBlock",value:function(e){switch(this._closeAllCards(),this._body.removeAttribute("hidden"),this._allBlock.forEach(function(e){return e.setAttribute("hidden",!0)}),e.removeAttribute("hidden"),e){case this._about:this._btnAbout.classList.add("card-tower__btn_active"),this._btnLayouts.classList.remove("card-tower__btn_active");break;default:this._btnLayouts.classList.add("card-tower__btn_active"),this._btnAbout.classList.remove("card-tower__btn_active")}}},{key:"hideBlock",value:function(){this._body.setAttribute("hidden",!0),this._allBlock.forEach(function(e){return e.removeAttribute("hidden")}),this._btnAbout.classList.remove("card-tower__btn_active"),this._btnLayouts.classList.remove("card-tower__btn_active")}},{key:"changeLayout",value:function(e){var n,a=e.target.closest(".card-tower__table-row");a&&(_toConsumableArray(this._rowsWrap.children).forEach(function(e,t){e===a&&(n=t),e.classList.remove("active")}),a.classList.add("active"),_toConsumableArray(this._images.children).forEach(function(e,t){t===n?e.removeAttribute("hidden"):e.setAttribute("hidden",!0)}))}},{key:"_closeAllCards",value:function(){this._allCards.forEach(function(e){e.querySelector(".card-tower__body").setAttribute("hidden",!0),e.querySelectorAll(".card-tower__btn").forEach(function(e){return e.classList.remove("card-tower__btn_active")})})}},{key:"_toggleBlock",value:function(e,t){e.target.closest(".card-tower__btn").classList.contains("card-tower__btn_active")?this.hideBlock():this.showBlock(t)}},{key:"_bind",value:function(){var t=this;this._btnAbout.addEventListener("click",function(e){return t._toggleBlock(e,t._about)}),this._btnLayouts.addEventListener("click",function(e){return t._toggleBlock(e,t._layouts)}),this._btnClose.addEventListener("click",function(){return t.hideBlock()}),this._rowsWrap.addEventListener("mouseover",function(e){return t.changeLayout(e)})}}]),t}(),GalleryCards=function(){function n(e,t){_classCallCheck(this,n),this._gallery=e,this._index=t,this._render(),this._bind(),refreshFsLightbox()}return _createClass(n,[{key:"_render",value:function(){this._gallery.insertAdjacentHTML("beforeend",this._generateTemplate())}},{key:"_bind",value:function(){var t=this,r=this._gallery.querySelector(".card-tower__sections");r.addEventListener("mouseover",function(e){var n,a=e.target.closest(".card-tower__section");_toConsumableArray(r.children).forEach(function(e,t){a===e&&(n=t),e.classList.remove("active")}),_toConsumableArray(t._gallery.children).forEach(function(e){return e.classList.remove("active")}),a.classList.add("active"),_toConsumableArray(t._gallery.children)[n].classList.add("active")})}},{key:"_generateTemplate",value:function(){var e=this._gallery.childElementCount,t=[];return _toConsumableArray(this._gallery.children).forEach(function(e){return t.push(e.src.split(location.origin).join(""))}),'\n      <div class="card-tower__sections">\n        '.concat(this._getTemplateSection(e,t),"\n      </div>\n    ")}},{key:"_getTemplateSection",value:function(e,t){for(var n="",a=0;a<e;a++)n+='<a class="card-tower__section" href="'.concat(t[a],'" data-fslightbox="gallery-').concat(this._index,'"></a>');return n}}]),n}();function setVariable(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))}ymaps.ready(function(){var u=new ymaps.Map("map-yandex",{center:[59.93,30.31],zoom:11}),e=JSON.parse(document.getElementById("json").textContent);e.forEach(function(e){var t,n,a,r,o,i=e.name,c=e.coordinates,s=e.address,l=e.img,d=e.id;u.geoObjects.add(new ymaps.Placemark(c,{hintLayout:i,balloonContentHeader:(a=l,r=d,'\n    <a class="card-map__header" href="#'.concat(o,'">\n      <img src="').concat(a,'" alt="').concat(r,'">\n    </a>\n  ')),balloonContentFooter:(t=i,n=s,'\n    <a class="card-map__footer" href="#'.concat(d,'">\n      <h2 class="card-map__title">').concat(t,'</h2>\n      <p class="card-map__address">').concat(n,"</p>\n    </a>\n  "))},{iconLayout:"default#imageWithContent",iconImageHref:"images/other/point-map.png",iconImageSize:[34,43],iconImageOffset:[-17,-43],iconContentOffset:[17,50]}))})}),setVariable(),window.onresize=setVariable;
//# sourceMappingURL=script.0374692a013257cad576068ca8c53dd5.min.js.map
